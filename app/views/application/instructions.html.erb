<section>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <h1>Welcome <%= @user.name %></h1>
        <p><%= @user.id %></p>
        <!-- FIXME
        <div class="embed-responsive embed-responsive-16by9">
          <iframe class="embed-responsive-item" src="https://www.youtube.com//embed/91XPH_6pL_0"></iframe>
        </div>
        -->
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-info">
          <div class="panel-heading">
            <h3>Capture #1</h3>
          </div>
          <div class="panel-body">
            <%= simple_form_for :photo, html: { id: @form_id } do |f| %>
              <%= f.input :file, as: :file, input_html: { accept: 'image/*', capture: 'camera' } %>
              <button type="button" class="ajax-send-button" data-form-id="<%= @form_id %>">Send</button>
            <% end %>
          </div>        
        </div>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
jQuery(document).ready(function() {
  jQuery('button.ajax-send-button').on('click', function (e) {
    e.preventDefault();

    $id = $(e.target).data('form-id');

    $form = $('form#' + $id);

    $file = $form.find('#photo_file')[0].files[0];

    if ($file) {
      formData = new FormData();

      formData.append('photo[id]', $id);
      formData.append('photo[file]', $file);
      
      $.ajax({
        url: 'photos/new',
        data: formData,
        contentType: false,
        processData: false,
        method: 'POST'
      })
    }
  })
})
</script>
